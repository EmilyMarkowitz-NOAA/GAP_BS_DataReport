

```{r res-spp-vars-{{jj}} }
a <- report_spp1[which(report_spp1$file_name == comb[{{jj}}]), ]

spp_sci <- a$species_name[1]
spp_sci1 <- a$species_name1[1]
spp_code <- a$species_code[1]
spp_print <- a$print_name[1]
spp_file <- a$file_name[1]
# spp_taxon <- a$taxon[1]

# report_title == "community"
dataTcommF <- FALSE
spp_plot_sizecomp <- a$plot_sizecomp[1]
spp_plot_idw <- a$plot_idw[1]
spp_plot_pa <- FALSE
spp_table_cpue <- FALSE
spp_text <- TRUE

if (report_title == "data") {
  dataTcommF <- TRUE
  # spp_plot_pa <- FALSE
  spp_table_cpue <- a$table_cpue[1]
  spp_text <- a$text_spp[1]
}

land_start <- "" #felse(spp_table_cpue & report_title == "data", "<!---BLOCK_LANDSCAPE_START--->", "")
land_end <- "" # ifelse(spp_table_cpue & report_title == "data", "<!---BLOCK_LANDSCAPE_STOP--->", "")
show <- FALSE
pagebreak <- ifelse(report_title == "community", "", "\\pagebreak")
```


```{r res-spp-lang-{{jj}} }
# Native Languages Names
lang <- ""

if (report_title == "community") {

temp <- readr::read_csv(file = paste0(dir_out_rawdata, "/0_species_local_names.csv"))

lang <- data.frame(lang_long = as.character(names(temp)[grepl(pattern = "lang_", x = temp[1,])]), 
                   lang = as.character(temp[1,grepl(pattern = "lang_", x = temp[1,])]), 
                   name = as.character(t(report_spp[jj,] %>% dplyr::select( dplyr::starts_with("lang_")) )) )

lang <- rbind.data.frame(data.frame(name = c(ifelse(is.na(a$scientific_name_prev[a$print_name == spp_print][1]), NA, 
                                                    paste0("*", a$scientific_name_prev[a$print_name == spp_print][1], "*")), 
                                             ifelse(is.na(a$common_name_prev[a$print_name == spp_print][1]), NA, 
                                                    a$common_name_prev[a$print_name == spp_print][1])), 
                                    lang = c("scientific_name_prev", "common_name_prev"), 
                                    lang_long = c("Previous Scientific Name", "Other Common Names")), 
                         lang) %>%
  dplyr::filter(!is.na(name))

if (nrow(lang)>0) {
  lang  <- paste(paste0("**",lang$lang_long,"**: ",lang$name,"\n\n"), sep = "", collapse = "")
} else {
  lang <- ""
}
}
```

## `r stringr::str_to_title(spp_print)` `r ifelse(is.na(spp_sci), "", paste0("(",spp_sci,")")) `

`r lang `

```{r res-spp-data-wrangle-{{jj}}, eval = FALSE }
# find basic info about species
haul0 <- catch_haul_cruises %>%
    dplyr::select("station", "stratum", "latitude_dd_start", "longitude_dd_start",
                  "depth_m", "bottom_temperature_c" ,"surface_temperature_c",
                  "survey_name", "SRVY", "year", "species_code",
                  "weight_kg", "count", "hauljoin")

biomass_cpue <- biomass %>%
  dplyr::filter(year %in% c(maxyr, compareyr) &
                  species_code %in% spp_code[1] &
                  stratum %in% 999) %>%
  dplyr::select(SRVY, year, biomass_mt, population_count, cpue_kgkm2_mean, cpue_nokm2_mean) %>%
  dplyr::mutate(print_name = spp_print) %>%
  dplyr::rename(cpue_kgkm2 = cpue_kgkm2_mean,
                cpue_nokm2 = cpue_nokm2_mean) %>%
  dplyr::filter((biomass_mt !=0))

lengths_maxyr0 <- lengths_maxyr %>%
  dplyr::filter(species_code %in% spp_code) %>%
  dplyr::select(SRVY, species_code, frequency, sex, length_mm,
                length_type, sentancefrag)
```

```{r prep-cite-{{jj}}}
# fig_dist <- fig_sizecomp <- tab_wt <- tab_no <- NA

if (spp_plot_idw) {
  fig_dist <- paste0("\\@ref(fig:", "fig-dist-", spp_file, ifelse(report_title == "data", "-data", "-comm"), ")")

}

if (spp_plot_sizecomp) {
  fig_sizecomp <- paste0("\\@ref(fig:fig-sizecomp-", spp_file, ifelse(report_title == "data", "-data", "-comm"), ")")
} 

if (spp_table_cpue) {
  tab_wt <- paste0("\\@ref(tab:tab-est-", spp_file, "-wt)")
  tab_no <- paste0("\\@ref(tab:tab-est-", spp_file, "-num)")
}

fig_bt <- "\\@ref(fig:fig-temperature-bt-1) and \\@ref(fig:fig-temperature-bt-2)"
fig_st <- "\\@ref(fig:fig-temperature-st-1) and \\@ref(fig:fig-temperature-st-2)"

  if (report_title == "community") {
    tab_majorspp_bio <- tab_majortaxa_pchange <- c("\\@ref(tab-majortaxa-pchange-comm)")
  } else if (report_title == "data") {
    tab_majorspp_bio_EBS <- "\\@ref(tab:tab-majortaxa-pchange-EBS)"
    tab_majorspp_bio_NBS <- "\\@ref(tab:tab-majortaxa-pchange-NBS)"
  }
str0 <- ""
```


```{r res-spp-ebs-{{jj}}, results='asis', eval = FALSE}
tab0 <- str0 <- ""
show <- refcontent & spp_text & (nrow(biomass_cpue[(biomass_cpue$SRVY == "EBS" & biomass_cpue$print_name == spp_print),])>0)
if (show) {
  if (report_title == "community") {
    tab_majorspp_bio = c("tab_majortaxa_pchange")
  } else if (report_title == "data") {
    tab_majorspp_bio = tab_majorspp_bio_EBS
  }

temp <- species_content(
  SURVEY000 = "eastern Bering Sea",
  SRVY000 = "EBS",
  haul0 = haul0,
  biomass_cpue = biomass_cpue,
  length_maxyr0 = length_maxyr0,
  spp_print = spp_print,
  spp_code = spp_code,
  maxyr = maxyr,
  compareyr = compareyr,
  tab_majorspp_bio = tab_majorspp_bio,
  total_biomass = total_biomass,
  spp_info = spp_info)

tab0 <- temp$table_spp
str0 <- (temp$text_spp)
names(str0) <-  NULL
str0 <- (paste0(unlist(str0), collapse = "\n\n"))
}
# `r tab0`
```

`r ifelse(show, "*REFERENCE MATERIAL FOR WRITERS - START*", "")`

`r ifelse(show, "**Eastern Bering Sea (EBS)**", "")`

`r str0`

```{r res-spp-nbs-{{jj}}, results='asis', eval = FALSE}
tab0 <- str0 <- ""
show <- refcontent & spp_text & (nrow(biomass_cpue[(biomass_cpue$SRVY == "NBS" & biomass_cpue$print_name == spp_print),])>0)
if (show) {
    if (report_title == "community") {
    tab_majorspp_bio = c("tab_majortaxa_pchange")
  } else if (report_title == "data") {
    tab_majorspp_bio = tab_majorspp_bio_NBS
  }
temp <- species_content(
  SURVEY000 = "northern Bering Sea",
  SRVY000 = "NBS",
  haul0 = haul0,
  biomass_cpue = biomass_cpue,
  length_maxyr0 = length_maxyr0,
  spp_print = spp_print,
  spp_code = spp_code,
  maxyr = maxyr,
  compareyr = compareyr,
  tab_majorspp_bio = tab_majorspp_bio,
  total_biomass = total_biomass,
  spp_info = spp_info)

tab0 <- temp$table_spp
str0 <- (temp$text_spp)
names(str0) <-  NULL
str0 <- (paste0(unlist(str0), collapse = "\n\n"))
}
# `r tab0`
```

`r ifelse(show, ifelse(SRVY %in% "NEBS", "**Northern Bering Sea (NBS)**", ""), "")`

`r str0`

```{r res-spp-nebs-{{jj}}, results='asis', eval = FALSE}
tab0 <- str0 <- ""
show <- refcontent & spp_text &
  (nrow(biomass_cpue[(biomass_cpue$SRVY == "EBS" & biomass_cpue$print_name == spp_print),])>0 &
     nrow(biomass_cpue[(biomass_cpue$SRVY == "NBS" & biomass_cpue$print_name == spp_print),])>0)
if (show) {
  if (report_title == "community") {
    tab_majorspp_bio = c("tab_majortaxa_pchange")
  } else if (report_title == "data") {
    tab_majorspp_bio = paste0(tab_majorspp_bio_EBS, " and ", tab_majorspp_bio_NBS)
  }
temp <- species_content(
  SURVEY000 = "eastern and northern Bering Sea",
  SRVY000 = c("NBS", "EBS"),
  haul0 = haul0,
  biomass_cpue = biomass_cpue,
  length_maxyr0 = length_maxyr0,
  spp_print = spp_print,
  spp_code = spp_code,
  maxyr = maxyr,
  compareyr = compareyr,
  tab_majorspp_bio = tab_majorspp_bio,
  total_biomass = total_biomass,
  spp_info = spp_info)

tab0 <- temp$table_spp
str0 <- (temp$text_spp)
names(str0) <-  NULL
str0 <- (paste0(unlist(str0), collapse = "\n\n"))
}
# `r tab0`
```

`r ifelse(show, ifelse(SRVY %in% "NEBS", "**Northern and Eastern Bering Sea Combined (NEBS)**", ""), "")`

`r str0 `

`r ifelse(refcontent & spp_text, "*REFERENCE MATERIAL FOR WRITERS - END*", "")`

```{r spp-text-{{jj}}, child = paste0(dir_out_rawdata, spp_file,".Rmd"), eval=spp_text, results='asis'}
```

```{r tab-env-{{jj}} , eval = (report_title == "community")}
nickname <- paste0("tab-env-", spp_file) 
```

```{r tab-env-{{jj}}-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval = (report_title == "community")}
```

`r ifelse((report_title == "community"), "<br>", "") `

```{r tab-bio-{{jj}}, eval = (report_title == "community")}
nickname <- paste0("tab-bio-", spp_file)
```

```{r tab-bio-{{jj}}-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval = (report_title == "community")}
```

```{r fig-dist-{{jj}}}
nickname <- paste0("fig-dist-", spp_file, ifelse(report_title == "data", "-data", "-comm"))
```

```{r fig-dist-{{jj}}-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval=(spp_plot_idw | spp_plot_pa)}
```

```{r fig-sizecomp-{{jj}}}
nickname <- paste0("fig-sizecomp-", spp_file, ifelse(report_title == "data", "-data", "-comm"))
```

```{r fig-sizecomp-{{jj}}-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval=spp_plot_sizecomp}
```

<!-- `r land_start ` -->

`r pagebreak `

```{r tab-est-{{jj}}-wt}
nickname <- paste0("tab-est-", spp_file, "-wt")
```

```{r tab-est-{{jj}}-wt-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval=spp_table_cpue}
```

`r ifelse(spp_table_cpue, "<br>", "")`

```{r tab-est-{{jj}}-num}
nickname <- paste0("tab-est-",spp_file, "-num")
```

```{r tab-est-{{jj}}-num-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval=spp_table_cpue}
```

<!-- `r pagebreak ` -->

<!-- `r land_end ` -->
