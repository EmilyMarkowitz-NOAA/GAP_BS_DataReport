---
header-includes:
  \usepackage{float} \floatplacement{figure}{H}
  \newcommand{\beginsupplementappA}{\setcounter{table}{0}  \renewcommand{\thetable}{A\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{A\arabic{figure}}}
  \newcommand{\beginsupplementappB}{\setcounter{table}{0}  \renewcommand{\thetable}{B\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{B\arabic{figure}}}
  \newcommand{\beginsupplementappC}{\setcounter{table}{0}  \renewcommand{\thetable}{C\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{C\arabic{figure}}}
  \newcommand{\beginsupplementappD}{\setcounter{table}{0}  \renewcommand{\thetable}{D\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{D\arabic{figure}}}
---

```{r}



# \newcommand{\beginsupplement}{%
#   \setcounter{table}{0}
#   \renewcommand{\thetable}{A\arabic{table}}%
#   \setcounter{figure}{0}
#   \renewcommand{\thefigure}{A\arabic{figure}}%
# }
#      
# \section{Supplementary Material}
```

\pagebreak

# Appendices

<!-- https://stackoverflow.com/questions/51335125/adding-figures-and-tables-after-bibliography-in-rmarkdown -->

```{r app-dummy}
## Appendix A: Station and catch data
# 
# Appendix A contains station data by vessel for the `r text_list(paste0(haul_cruises_maxyr$stations_avail, " standard survey stations that were successfully completed in the ",haul_cruises_maxyr$SRVY))`. When using the tables, the following parameters should be noted:
# 
#    - Time represents the nearest hour and minute at the start of the haul in Alaska Daylight Time (ADT)
#    
#    - Haul numbers are not always sequential because unsatisfactory hauls were omitted.
#    
#    - All start and end longitudes and latitudes for each haul are displayed as degrees and decimal minutes.
#    
#    - Net measured codes are as follows: Y = Net width was measured by net mensuration gear. N = Net width was estimated from a function of inverse scope (wire out) and net height.
#    
#    - Catch weights are displayed in total kilograms.
# 
# **List of Tables**
# 
# `r text_list(paste0("\n\n - A ", sapply(list_tables[grepl(x = names(list_tables), pattern = "tab_app_hauls_catch_")],"[[","header")), oxford = FALSE, sep = " ", sep_last = " ") `
# 
# <!---BLOCK_LANDSCAPE_START--->
# 
# `r NMFSReports::crossref(list_obj = list_tables, nickname = "tab_app_hauls_catch_", sublist = "res", exact = FALSE) `
# 
# <!---BLOCK_LANDSCAPE_STOP--->
# 
# ## Appendix A: List of taxa encountered
# 
# Appendix A lists all fish and invertebrate taxa taken during the AFSC’s `r text_list(paste0(haul_cruises_maxyr$SRVY)) ` bottom trawl survey.
# 
# **List of Tables**
# 
# `r text_list(paste0("\n\n - Appendix B ", sapply(list_tables[grepl(x = names(list_tables), pattern = "tab_app_taxa_encountered_")],"[[","header")), oxford = FALSE, sep = " ", sep_last = " ") `
# 
# `r NMFSReports::crossref(list_obj = list_tables, nickname = "tab_app_taxa_encountered_", sublist = "res", exact = FALSE) `
# 
# ## Appendix B: List of taxa encountered
# 
# Appendix A lists all fish and invertebrate taxa taken during the AFSC’s `r text_list(paste0(haul_cruises_maxyr$SRVY)) ` bottom trawl survey.
# 
# **List of Tables**
# 
# `r text_list(paste0("\n\n - Appendix B ", sapply(list_tables[grepl(x = names(list_tables), pattern = "tab_app_taxa_encountered_")],"[[","header")), oxford = FALSE, sep = " ", sep_last = " ") `
# 
# `r NMFSReports::crossref(list_obj = list_tables, nickname = "tab_app_taxa_encountered_", sublist = "res", exact = FALSE) `
# 
# 
# ## Appendix C: Population estimates by sex and size group for principal fish species
# 
# Appendix C presents population estimates by sex and size group from the `r maxyr` `r text_list(paste0(haul_cruises_maxyr$SRVY))` survey`r ifelse(length(haul_cruises_maxyr$SRVY)>1, "s", "")` for principal fish species.
# 
# **List of Tables**
# 
# `r text_list(paste0("\n\n - Appendix C ", sapply(list_tables[grepl(x = names(list_tables), pattern = "tab_app_principal_fish_")],"[[","header")), oxford = FALSE, sep = " ", sep_last = " ") `
# 
# `r NMFSReports::crossref(list_obj = list_tables, nickname = "tab_app_principal_fish_", sublist = "res", exact = FALSE) `
# 
```


```{r tab_app_principal_fish_}
# nickname0 <- "tab_app_principal_fish_"
# 
# list_tables0 <- list_tables[grepl(x = names(list_tables), pattern = nickname0)]
# srvy <- unlist(unique(lapply(X = strsplit(x =
#                                             gsub(pattern = nickname0,
#                                                  replacement = "",
#                                                  x = names(list_tables0)), split = "_"),
#                              `[[`, 1)))
# abcd <- unique(gsub(pattern = "[0-9]+", 
#                     replacement = "", 
#                     x = unlist(lapply(list_tables0, `[[`, "number"))))
# 
# str0 <- ""
# 
# for (i in 1:length(abcd)) {
#   
#   list_tables00 <- list_tables0[grepl(x = names(list_tables0), pattern = srvy[i])]
#   
#   str0 <- paste0(str0, ifelse(str0 == "", "", "\\pagebreak"), 
#                  '## Appendix',abcd[i],
#                  ': Population estimates by sex and size group for principal fish species in the ', srvy[i], '
# 
# Appendix ',abcd[i],' presents population estimates by sex and size group from the ', maxyr,' ',
# srvy[i] , ' bottom trawl survey for principal fish species. 
# 
# **List of Tables**
# 
# ',
# text_list(paste0("\n\n - Appendix ",#abcd[i]," ", 
#                  sapply(list_tables00, #[grepl(x = names(list_tables00), pattern = "tab_app_taxa_encountered_")],
#                         "[[","header")), 
#           oxford = FALSE, sep = " ", sep_last = " "),
# '
# \n\n\n
# '#, 
# # NMFSReports::crossref(list_obj = list_tables00, 
# #                       nickname = "", 
# #                       sublist = "res", exact = FALSE),
# # '
# # \n\n\n
# # '
#   )
# }

```

```{r list_app_function}
counter_letters <- 0
evalTF <- ifelse(SRVY == "NEBS", TRUE, FALSE)
list_app <- function(nickname, dir_out_figtab, abcd, srvy, descr_short, descr_frag) {
  
  a <- list.files(path = dir_out_figtab, 
                  pattern = nickname, 
                  full.names = FALSE)
  
  nickname0 <- gsub(pattern = ".rdata",  
                    replacement = "", 
                    x = a[grepl(pattern = ".rdata", x = a)], 
                    ignore.case = TRUE)
  
  captions <- data.frame()
  for (i in 1:length(nickname0)) {
    a <- readtext(paste0(dir_out_figtab, nickname0[i], ".txt"))
    captions <- dplyr::bind_rows(
      captions, 
      data.frame(
        "id" = nickname0[i], 
        "capt" = a$text))
  }
    # # (APPENDIX) Appendix {-}
    str0 <- paste0(
    ifelse(abcd == "A", 
'

', 
'\\pagebreak

'),

'## Appendix ',abcd,': List of ', descr_short,'

Appendix ',abcd, " ", descr_frag, '

**List of Tables**

',
text_list(paste0("\n\n - Appendix **", abcd, "** \\@ref(tab:", captions$id, "): ", captions$capt),
                 # sapply(list_tables00, #[grepl(x = names(list_tables00), pattern = "tab_app_taxa_encountered_")], "[[","header")), 
          oxford = FALSE, sep = " ", sep_last = " "),
'

\\pagebreak

' )
    
    return(str0)
}

# https://support.authorea.com/en-us/article/how-to-create-an-appendix-section-or-supplementary-information-1g25i5a/
# Appendices {-}

```

\beginsupplementappA

```{r tab-app-taxa-encountered-EBS}
nickname <- "tab-app-taxa-encountered-EBS"
counter_letters <- counter_letters + 1; abcd <- LETTERS[counter_letters]
str0 <- list_app(nickname = nickname, 
                 dir_out_figtab = dir_out_figtab, 
                 abcd = abcd, 
                 descr_short = "taxa encountered in the eastern Bering Sea", 
                 descr_frag = paste0("lists all fish and invertebrate taxa taken during the AFSC’s eastern Bering Sea bottom trawl survey."))
```

`r str0 `

```{r tab-special-projects-EBS-child, child = paste0(dir_code, "_child_report_figtab.Rmd")}
```

\beginsupplementappB

```{r tab-app-taxa-encountered-NBS, eval = evalTF}
nickname <- "tab-app-taxa-encountered-NBS"
counter_letters <- counter_letters + 1; abcd <- LETTERS[counter_letters]
str0 <- list_app(nickname = nickname, 
                 dir_out_figtab = dir_out_figtab, 
                 abcd = abcd, 
                 descr_short = "taxa encountered in the northern Bering Sea", 
                 descr_frag = paste0("lists all fish and invertebrate taxa taken during the AFSC’s northern Bering Sea bottom trawl survey."))
```

`r str0 `

```{r tab-special-projects-NBS-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval=evalTF}
```

`r ifelse(evalTF, "\\beginsupplementappC", "")`

```{r tab-app-principal-fish-EBS-}
nickname <- "tab-app-principal-fish-EBS-"
counter_letters <- counter_letters + 1; abcd <- LETTERS[counter_letters]
str0 <- list_app(nickname = nickname, 
                 dir_out_figtab = dir_out_figtab, 
                 abcd = abcd, 
                 descr_short = "population estimates by sex and size group for principal fish species in the eastern Bering Sea", 
                 descr_frag = paste0("presents population estimates by sex and size group from the ", 
                                     maxyr,
                                     " eastern Bering Sea bottom trawl survey for principal fish species."))
```

`r str0 `

```{r tab-app-principal-fish-EBS-child, child = paste0(dir_code, "_child_report_figtab.Rmd")}
```

`r ifelse(evalTF, "\\beginsupplementappD", "")`

```{r tab-app-principal-fish-NBS-, eval = evalTF}
nickname <- "tab-app-principal-fish-NBS-"
counter_letters <- counter_letters + 1; abcd <- LETTERS[counter_letters]
str0 <- list_app(nickname = nickname, 
                 dir_out_figtab = dir_out_figtab, 
                 abcd = abcd, 
                 descr_short = "population estimates by sex and size group for principal fish species in the northern Bering Sea", 
                 descr_frag = paste0("presents population estimates by sex and size group from the ", 
                                     maxyr,
                                     " northern Bering Sea bottom trawl survey for principal fish species."))
```

`r str0 `

```{r tab-app-principal-fish-NBS-child, child = paste0(dir_code, "_child_report_figtab.Rmd"), eval=evalTF}
```
